{% extends "base.html" %}
{% block title %}Projects - Binary Project System{% endblock %}

{% block content %}
<div style="max-width:1100px;margin:0 auto;padding:2rem 1.5rem;">

    <!-- Header -->
    <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:1.8rem;flex-wrap:wrap;gap:1rem;">
        <div>
            <h1 class="page-title">All Projects</h1>
            <p class="page-subtitle">Browse and search project submissions</p>
        </div>
        <a href="{{ url_for('new_project') }}" class="btn-oc btn-oc-primary">
            <i class="bi bi-plus-lg"></i> New Project
        </a>
    </div>

    <!-- Filters -->
    <div class="oc-card" style="margin-bottom:1.2rem;">
        <div class="oc-card-body">
            <form id="filterForm"
                  hx-get="{{ url_for('htmx_projects') }}"
                  hx-target="#projectsList"
                  hx-trigger="change, input delay:500ms from:#searchInput">
                <div style="display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:0.75rem;align-items:end;">
                    <div>
                        <label class="oc-label">Search</label>
                        <div style="position:relative;">
                            <i class="bi bi-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--text-muted);font-size:0.85rem;"></i>
                            <input type="text"
                                   class="oc-input"
                                   id="searchInput"
                                   name="search"
                                   placeholder="Search projects..."
                                   value="{{ search_query }}"
                                   style="padding-left:2rem;">
                        </div>
                    </div>
                    <div>
                        <label class="oc-label">Stream</label>
                        <select class="oc-select" name="stream" id="streamFilter">
                            <option value="">All Streams</option>
                            {% for stream in streams %}
                            <option value="{{ stream.id }}" {% if current_stream == stream.id %}selected{% endif %}>{{ stream.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="oc-label">Status</label>
                        <select class="oc-select" name="status" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="approved"     {% if current_status == 'approved' %}selected{% endif %}>Approved</option>
                            <option value="pending"      {% if current_status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="under_review" {% if current_status == 'under_review' %}selected{% endif %}>Under Review</option>
                            <option value="rejected"     {% if current_status == 'rejected' %}selected{% endif %}>Rejected</option>
                            <option value="duplicate"    {% if current_status == 'duplicate' %}selected{% endif %}>Duplicate</option>
                        </select>
                    </div>
                    <div>
                        <label class="oc-label" style="opacity:0;">Reset</label>
                        <button type="reset" class="btn-oc btn-oc-outline" style="width:100%;" onclick="this.form.reset(); this.form.dispatchEvent(new Event('change'));">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Results -->
    <div id="projectsList">
        {% include 'partials/project_list.html' %}
    </div>
</div>

<style>
@media(max-width:768px){
    form > div[style*="grid-template-columns"]{grid-template-columns:1fr !important;}
}
</style>
{% endblock %}
